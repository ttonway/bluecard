{"version":3,"sources":["js/recordlist.js"],"names":["$","reloadTable","prop","table","tableEl","DataTable","language","myApp","datatablesLang","destroy","paging","lengthChange","searching","ordering","info","autoWidth","serverSide","ajax","data","callback","settings","status","attr","searchValue","search","value","type","cache","url","success","res","result","parseJSON","code","cntList","cntlist","cntMap","i","length","map","cnt","each","this","find","text","columns","class","orderable","defaultContent","render","full","meta","recordId","orgName","on","removeClass","addClass","is","allChecked","len","alert","hide","modal","loanid","flag","row","parents","show","push","traditional","r","Math","random"],"mappings":"AAAAA,EAAE,WAKE,QAASC,KAELD,EAAE,0CAA0CE,KAAK,WAAW,GAE5DC,EAAQC,EAAQC,WACZC,SAAUC,MAAMC,eAChBC,SAAW,EACXC,QAAU,EACVC,cAAgB,EAChBC,WAAa,EACbC,UAAY,EACZC,MAAQ,EACRC,WAAa,EACbC,YAAc,EACdC,KAAQ,SAAUC,EAAMC,EAAUC,GAC9BF,EAAKG,OAASrB,EAAE,oBAAoBsB,KAAK,UACzCJ,EAAKK,YAAcL,EAAKM,OAAOC,MAC/BzB,EAAEiB,MACES,KAAM,OACNC,OAAO,EACPT,KAAMA,EACNU,IAAK,OACLC,QAAS,SAAUC,GACf,GAAIC,GAAS/B,EAAEgC,UAAUF,EACzB,IAAmB,GAAfC,EAAOE,KAAW,CAGlB,IAAK,GAFDC,GAAUH,EAAOI,QACjBC,KACKC,EAAI,EAAGA,EAAIH,EAAQI,OAAQD,IAAK,CACrC,GAAIE,GAAML,EAAQG,EAClBD,GAAOG,EAAIlB,QAAUkB,EAAIC,IAE7BxC,EAAE,aAAayC,KAAK,WAChB,GAAID,GAAMJ,EAAOpC,EAAE0C,MAAMpB,KAAK,YAAc,CAC5CtB,GAAE0C,MAAMC,KAAK,QAAQC,KAAK,IAAMJ,EAAM,OAG1CrB,EAASY,QAKzBc,UAEQC,QAAS,cACTC,WAAa,EACb7B,KAAQ,KACR8B,eAAkB,8CAGlBF,QAAS,YACT5B,KAAQ,WACR+B,OAAU,SAAU/B,EAAMQ,EAAMwB,EAAMC,GAClC,MAAO,iBAAmBD,EAAKE,SAAW,KAAOlC,EAAO,UAG/DA,KAAQ,gBACRA,KAAQ,eACRA,KAAQ,qBAELA,KAAQ,eACR+B,OAAU,SAAU/B,EAAMQ,EAAMwB,EAAMC,GAClC,MAAOjC,GAAOA,EAAKmC,QAAU,MAGpCnC,KAAQ,kBACRA,KAAQ,iBApErB,GACIf,GADAC,EAAUJ,EAAE,gBAyEhBC,KACAD,EAAE,aAAasD,GAAG,QAAS,WACvBtD,EAAE,aAAauD,YAAY,UAC3BvD,EAAE0C,MAAMc,SAAS,UACjBvD,MAGJG,EAAQkD,GAAG,SAAU,yCAA0C,WAC3DtD,EAAE,2CAA2CE,KAAK,UAAWF,EAAE0C,MAAMe,GAAG,eAE5ErD,EAAQkD,GAAG,SAAU,0CAA2C,WAC5D,GAAII,GAAmF,IAAtE1D,EAAE,yDAAyDsC,MAC5EtC,GAAE,0CAA0CE,KAAK,UAAWwD,KAKhE1D,EAAE,eAAesD,GAAG,QAAS,WACzB,GAAIK,GAAM3D,EAAE,mDAAmDsC,MAC/D,OAAW,IAAPqB,MACAC,OAAM,UAGN5D,EAAE,gCAAgC6D,OAClC7D,EAAE,+BAA+B6D,OACjC7D,EAAE,iBAAiB8D,QAFnB9D,UAKRA,EAAE,mCAAmCsD,GAAG,QAAS,WAC7C,GAAIS,MACAC,EAAO,CACXhE,GAAE,mDAAmDyC,KAAK,WACtD,GAAIvB,GAAOf,EAAM8D,IAAIjE,EAAE0C,MAAMwB,QAAQ,OAAOhD,MACzB,IAAfA,EAAKG,SACLrB,EAAE,+BAA+B4C,KAAK,aACtC5C,EAAE,+BAA+BmE,OACjCH,EAAO,GAEXD,EAAOK,KAAKlD,EAAK6C,UAET,GAARC,GAAaD,EAAOzB,OAAS,GAC7BtC,EAAEiB,MACES,KAAM,OACNC,OAAO,EACP0C,aAAa,EACbnD,MACI6C,OAAQA,EACRO,EAAGC,KAAKC,UAEZ5C,IAAK,cACLC,QAAS,SAAUC,GACf,GAAIC,GAAS/B,EAAEgC,UAAUF,EACN,IAAfC,EAAOE,MACPjC,EAAE,gCAAgC4C,KAAK,QACvC5C,EAAE,gCAAgCmE,OAElClE,MAEAD,EAAE,+BAA+B4C,KAAK,QACtC5C,EAAE,+BAA+BmE","file":"recordlist-3a8bd2b155.js","sourcesContent":["$(function () {\r\n\r\n    var tableEl = $('#record-table');\r\n    var table;\r\n\r\n    function reloadTable() {\r\n\r\n        $(\"input[type='checkbox'][name='chk_all']\").prop(\"checked\", false);\r\n\r\n        table = tableEl.DataTable({\r\n            language: myApp.datatablesLang,\r\n            \"destroy\": true,\r\n            \"paging\": true,\r\n            \"lengthChange\": false,\r\n            \"searching\": true,\r\n            \"ordering\": false,\r\n            \"info\": true,\r\n            \"autoWidth\": false,\r\n            \"serverSide\": true,\r\n            \"ajax\": function (data, callback, settings) {\r\n                data.status = $('.category.active').attr('status');\r\n                data.searchValue = data.search.value;\r\n                $.ajax({\r\n                    type: \"post\",\r\n                    cache: false,\r\n                    data: data,\r\n                    url: \"list\",\r\n                    success: function (res) {\r\n                        var result = $.parseJSON(res);\r\n                        if (result.code == 0) {\r\n                            var cntList = result.cntlist;\r\n                            var cntMap = {};\r\n                            for (var i = 0; i < cntList.length; i++) {\r\n                                var map = cntList[i];\r\n                                cntMap[map.status] = map.cnt;\r\n                            }\r\n                            $('.category').each(function () {\r\n                                var cnt = cntMap[$(this).attr('status')] || 0;\r\n                                $(this).find('span').text(\"(\" + cnt + \")\");\r\n                            });\r\n\r\n                            callback(result);\r\n                        }\r\n                    }\r\n                });\r\n            },\r\n            \"columns\": [\r\n                {\r\n                    \"class\": 'td-checkbox',\r\n                    \"orderable\": false,\r\n                    \"data\": null,\r\n                    \"defaultContent\": '<input type=\"checkbox\" name=\"chk_item\"\"/>'\r\n                },\r\n                {\r\n                    \"class\": 'record-id',\r\n                    \"data\": \"userName\",\r\n                    \"render\": function (data, type, full, meta) {\r\n                        return '<a href=\"view/' + full.recordId + '\">' + data + '</a>';\r\n                    }\r\n                },\r\n                {\"data\": \"phoneNumber\"},\r\n                {\"data\": \"profession\"},\r\n                {\"data\": \"accumulationFund\"},\r\n                {\r\n                    \"data\": \"organization\",\r\n                    \"render\": function (data, type, full, meta) {\r\n                        return data ? data.orgName : '';\r\n                    }\r\n                },\r\n                {\"data\": \"bank.bankName\"},\r\n                {\"data\": \"createTime\"}\r\n            ]\r\n        });\r\n    }\r\n\r\n    reloadTable();\r\n    $('.category').on('click', function () {\r\n        $('.category').removeClass('active');\r\n        $(this).addClass('active');\r\n        reloadTable();\r\n    });\r\n\r\n    tableEl.on(\"change\", \"input[type='checkbox'][name='chk_all']\", function () {\r\n        $(\"input[type='checkbox'][name='chk_item']\").prop(\"checked\", $(this).is(':checked'));\r\n    });\r\n    tableEl.on(\"change\", \"input[type='checkbox'][name='chk_item']\", function () {\r\n        var allChecked = $(\"input[type='checkbox'][name='chk_item']:not(:checked)\").length === 0;\r\n        $(\"input[type='checkbox'][name='chk_all']\").prop(\"checked\", allChecked);\r\n    });\r\n\r\n\r\n    // 删除\r\n    $('#showDelete').on('click', function () {\r\n        var len = $(\"input[type='checkbox'][name='chk_item']:checked\").length;\r\n        if (len == 0) {\r\n            alert(\"请选择用户\");\r\n            return;\r\n        } else {\r\n            $('#delete-modal .alert-success').hide();\r\n            $('#delete-modal .alert-danger').hide();\r\n            $('#delete-modal').modal();\r\n        }\r\n    });\r\n    $('#delete-modal button.btn-danger').on('click', function () {\r\n        var loanid = [];\r\n        var flag = 1;\r\n        $(\"input[type='checkbox'][name='chk_item']:checked\").each(function () {\r\n            var data = table.row($(this).parents('tr')).data();\r\n            if (data.status != 0) {\r\n                $('#delete-modal .alert-danger').text(\"只能删除待联系客户\");\r\n                $('#delete-modal .alert-danger').show();\r\n                flag = 0;\r\n            }\r\n            loanid.push(data.loanid);\r\n        });\r\n        if (flag == 1 && loanid.length > 0) {\r\n            $.ajax({\r\n                type: \"post\",\r\n                cache: false,\r\n                traditional: true,\r\n                data: {\r\n                    loanid: loanid,\r\n                    r: Math.random()\r\n                },\r\n                url: \"loan/delete\",\r\n                success: function (res) {\r\n                    var result = $.parseJSON(res);\r\n                    if (result.code == 0) {\r\n                        $('#delete-modal .alert-success').text(\"删除成功\");\r\n                        $('#delete-modal .alert-success').show();\r\n\r\n                        reloadTable();\r\n                    } else {\r\n                        $('#delete-modal .alert-danger').text(\"删除失败\");\r\n                        $('#delete-modal .alert-danger').show();\r\n                    }\r\n                }\r\n            });\r\n        }\r\n    });\r\n});"]}